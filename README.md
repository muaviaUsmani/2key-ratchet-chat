# 2key-ratchet-chat

## Setup
Clone the repo and run `yarn`

## How to 
To generate keys run
```
tsc index.ts && node index.js generate
```
This should return an object containing first user's (Alice) identity, and her preKeyBuffer as base64 string.
```
{
    "identityKey":{
        "createdAt":"2020-12-07T08:01:13.295Z",
        "exchangeKey":{
            "privateKey":[
                "CryptoKey"
            ],
            "publicKey":[
                "CryptoKey"
            ],
            "thumbprint":"534f8a8aeb4ae98ea27dcdd1cb25fcf86a44d8c623900f4ce3fff18cdab03912"
        },
        "id":16453,
        "preKeys":[
            [
                "Object"
            ]
        ],
        "signedPreKeys":[
            [
                "Object"
            ]
        ],
        "signingKey":{
            "privateKey":[
                "CryptoKey"
            ],
            "publicKey":[
                "CryptoKey"
            ],
            "thumbprint":"141e0fb86959945c431b9bb1c24fa9a0236d344c03a11a75cab5d5f6603ca915"
        }
    },             "preKeyBuffer":"MjU2LDUwNDQwLDM4NCw1Nzg3NCwxLDI1NjEsMzIwLDUxNzAsNjQ2NzgsNDUyMjEsMjMxMjUsMzAzNjQsNTMyNTcsMTIyMDksNDcwMiw0MDU2MiwzNDA0NiwxODI3NSwzNzA4OCwxOTk0MSw0MjI3Miw0MTMzMCwyMDMwNCwxMDQyMywyNTYwMyw1ODI3MiwyMzY3NywxODM2OCw0OTc3NCw0Mjg1NCwxMzU1OCwzOTk0LDM5NTA4LDY5NTUsMTYxMDksNDAyNDMsNDI1MiwyOTc4MCw0Njc0LDE0NDAwLDMyMzYwLDIyMDE2LDUwMzE1LDYxNzU5LDYxNjk4LDcyNDksMzA3MzYsNTA2OTIsNDU5NzksMjUzMzQsNTIxNjgsNzU1Miw0MTQ3NCwxMzU2Niw1MjEyNyw1NTQ4Miw3NzE0LDM2NTY2LDc3OCwxNTUzLDMzMDY4LDUwMywzMDI0Miw1NTAwMSwyNjUzMCwyOTk3Miw4OTQsMjM2MTUsNjk2Myw1NjQ2NywxNDEwNCw2Nzk4LDYwNzM2LDI1MDMsMzU2OTEsNTIzMjksMTI5MjQsMjY5NDcsMTY0NDYsNTc2MDYsNDMyNDgsMzM4MzQsNDQ5MywxNjk2NCwxOTg4NiwzMTc4Miw0NjI4Miw0NDgzNCw1NDgxMiwyMDk5MSwyODczLDI3NTI3LDM0MzEyLDM3MTI0LDM1OTY2LDQzMzk1LDEwNjg4LDQ5OTI2LDM4Mzk3LDQ3ODcwLDk1NjQsMzgyMjksMzc5NzMsNjM2MjIsODg2MSwxMjgyNCwxMjg0OCwxMTU2OCwxMjg0OSwxMjMzMywyMTU1OSwxNDM4NCwxMjM0NiwxNDg5NywxMzEwNSwxMjg0NiwxMzYyNSw4Nzk0LDM5MiwyNTYsOCwxNjQwMiw1OTQyOCwzNDk1OSw2MTkyNiwzNTI0MiwyODQxNSwzMDU3MSwxNzk1NSw4NDU1LDk4NzEsMzkwNTEsODAzNiwxMDQ2NiwyOTkzMiwxMjg2OCwzODE2NCwzMTM2LDM3MzE0LDM1MzU1LDQxNzU5LDQ5NDM4LDU5NDg4LDMzNDUyLDI2NTgxLDUxODcwLDU4MDcsMTU0ODgsNTQyMDUsMTYwNSw0MzkyLDMwNTM5LDUzMzk2LDE4NzY1LDE2NDEwLDYyNTMwLDE4MTU5LDM4ODA1LDQ2NTA4LDU3NDc0LDI2MzM5LDYxMjAwLDU4NzMsMzY1LDMzNTgyLDYzMTI4LDE3NzgwLDI3MzYzLDQ4MTY1LDUzMDQzLDg3NDgsNzczNSw3NzE1LDE3NTI1LDI0NDY4LDI3Njc1LDU1NDUyLDQ2NTAzLDE3MzY5LDI5MzgsNDQxODAsMzMzOTQsNDg0ODMsNDA2MDcsNTk1NDIsMjcwOTYsNTg3MTU="
}
```
To encrypt a message, run
```
tsc index.ts && node index.js encrypt [alice's prekey buffer] [message]
```
For example
```
tsc index.ts && node index.js encrypt MjU2LDUwNDQwLDM4NCw1Nzg3NCwxLDI1NjEsMzIwLDUxNzAsNjQ2NzgsNDUyMjEsMjMxMjUsMzAzNjQsNTMyNTcsMTIyMDksNDcwMiw0MDU2MiwzNDA0NiwxODI3NSwzNzA4OCwxOTk0MSw0MjI3Miw0MTMzMCwyMDMwNCwxMDQyMywyNTYwMyw1ODI3MiwyMzY3NywxODM2OCw0OTc3NCw0Mjg1NCwxMzU1OCwzOTk0LDM5NTA4LDY5NTUsMTYxMDksNDAyNDMsNDI1MiwyOTc4MCw0Njc0LDE0NDAwLDMyMzYwLDIyMDE2LDUwMzE1LDYxNzU5LDYxNjk4LDcyNDksMzA3MzYsNTA2OTIsNDU5NzksMjUzMzQsNTIxNjgsNzU1Miw0MTQ3NCwxMzU2Niw1MjEyNyw1NTQ4Miw3NzE0LDM2NTY2LDc3OCwxNTUzLDMzMDY4LDUwMywzMDI0Miw1NTAwMSwyNjUzMCwyOTk3Miw4OTQsMjM2MTUsNjk2Myw1NjQ2NywxNDEwNCw2Nzk4LDYwNzM2LDI1MDMsMzU2OTEsNTIzMjksMTI5MjQsMjY5NDcsMTY0NDYsNTc2MDYsNDMyNDgsMzM4MzQsNDQ5MywxNjk2NCwxOTg4NiwzMTc4Miw0NjI4Miw0NDgzNCw1NDgxMiwyMDk5MSwyODczLDI3NTI3LDM0MzEyLDM3MTI0LDM1OTY2LDQzMzk1LDEwNjg4LDQ5OTI2LDM4Mzk3LDQ3ODcwLDk1NjQsMzgyMjksMzc5NzMsNjM2MjIsODg2MSwxMjgyNCwxMjg0OCwxMTU2OCwxMjg0OSwxMjMzMywyMTU1OSwxNDM4NCwxMjM0NiwxNDg5NywxMzEwNSwxMjg0NiwxMzYyNSw4Nzk0LDM5MiwyNTYsOCwxNjQwMiw1OTQyOCwzNDk1OSw2MTkyNiwzNTI0MiwyODQxNSwzMDU3MSwxNzk1NSw4NDU1LDk4NzEsMzkwNTEsODAzNiwxMDQ2NiwyOTkzMiwxMjg2OCwzODE2NCwzMTM2LDM3MzE0LDM1MzU1LDQxNzU5LDQ5NDM4LDU5NDg4LDMzNDUyLDI2NTgxLDUxODcwLDU4MDcsMTU0ODgsNTQyMDUsMTYwNSw0MzkyLDMwNTM5LDUzMzk2LDE4NzY1LDE2NDEwLDYyNTMwLDE4MTU5LDM4ODA1LDQ2NTA4LDU3NDc0LDI2MzM5LDYxMjAwLDU4NzMsMzY1LDMzNTgyLDYzMTI4LDE3NzgwLDI3MzYzLDQ4MTY1LDUzMDQzLDg3NDgsNzczNSw3NzE1LDE3NTI1LDI0NDY4LDI3Njc1LDU1NDUyLDQ2NTAzLDE3MzY5LDI5MzgsNDQxODAsMzMzOTQsNDg0ODMsNDA2MDcsNTk1NDIsMjcwOTYsNTg3MTU= "Hello there"
```
Would return the encrypted message
```
MjU2LDUwNDQwLDM4NCwyNCwxNjQxOCwxODE4MCw1NDQyMywyOTUxMyw0ODE2OCw1ODQzMiw0Mjg0MiwxNDA4LDI5NDc3LDY1NzUsMjU0NTIsOTc4MywxNjYyOSw1NzAxNyw1NjQ0LDEyNTg0LDU0ODUsNTAzNjQsMzIxMDUsMjU0NTEsNTYyMDYsMjc4ODksNDU4MjAsMzYyMyw0NjUwNywzMDU4OCwyMTU5OCw1NzY4MiwzMDEyNiwyOTkyNCw0NTc2OSwzMzY5NCw5NjM1LDU3ODk4LDEsMjU2MSwyMjg0OCw0OTE4MywzNDIzNyw1NDEzOSwyNzI4Niw0NzY3NCwxMjUxMSwyODYxMCw0MzE4LDI0OTkxLDY0MzYyLDE3MzkxLDE4NDg2LDE3MzcwLDEzNjk2LDM2MTI3LDU1NzgxLDM5MzU4LDQ3MjY3LDQ1NTA2LDEyOTA4LDM5MTQzLDUwMTIxLDExNjAsODIyNCw0MDU1Nyw0NjM0Nyw1NDU0OCw0NDksNjQ5ODEsMzM3ODQsNDU0MjUsNDc4NCw1MzMxMiw2MjI1NCwzNzE2Miw1NDg0Nyw3NjY0LDI2MTU5LDI3MTIzLDE1NzUwLDU4MDUzLDM3MTU2LDQzMzYwLDMwNDIzLDQ3ODk0LDQ3NTk2LDI2MDYzLDI0MjM2LDExNTMxLDIwOTg3LDM3OTEsNTcxMDEsMjU2ODEsNjQwODUsNjI1MTcsNDU3NDIsMzQ1NzUsNDE5MTEsMzI2MiwzMjU3NCwyMzcyMywxODc4Niw0OTk1MCw4MDQxLDY3NzgsMTg1Niw4Njc2LDUxMTMzLDU3NDMwLDE1Nzk2LDYxMTQ5LDU2ODU2LDcwODcsMzUwNzksNDYzODEsNDAzNTgsNjkwOCwxNjE0MCw3ODgyLDM0MDcxLDY0MjEwLDQ3OTAzLDUyNjIxLDEyMDg4LDU4NTMzLDI1MDAsMzYxMDQsMzE4MDgsNTg4NjQsMzcyNyw1OTA2MCwxMTM4Miw4ODcwLDEwMDAyLDU5NTIxLDMzMzY4LDI1MTc1LDg5MDAsMTI4MjQsMTI4NDgsMTE1NjgsMTI4NDksMTIzMzMsMjE1NTksMTQzODQsMTIzNDYsMTQ5MDEsMTM4NzcsMTI4NDYsMTMzNjQsMTI4OTAsNDUwLDI1NiwxNjM5NCw4MDI1LDQ4NTc2LDMxNjIxLDM4NjExLDE0OTU0LDU3Mjc0LDQ5NzEyLDU2OTQzLDQwNzIwLDI3MjMzLDYxNDM1LDEzODkxLDU1ODgwLDMyODM1LDc5ODksNTg3NjUsNDg4NTcsNDE4ODEsNDk4NDgsMjc4MjUsNTkxODYsNTE2MDgsMzUwMTEsODE5NiwyNzkzNiwyOTc0LDUzMDEsNDk2MjEsNTQ1MjksNjM3NDEsMjkwNTksNDUyMzMsMjMwNTgsMjU2LDE2Mzk0LDE4MTgwLDU0NDIzLDI5NTEzLDQ4MTY4LDU4NDMyLDQyODQyLDE0MDgsMjk0NzcsNjU3NSwyNTQ1Miw5NzgzLDE2NjI5LDU3MDE3LDU2NDQsMTI1ODQsNTQ4NSw1MDM2NCwzMjEwNSwyNTQ1MSw1NjIwNiwyNzg4OSw0NTgyMCwzNjIzLDQ2NTA3LDMwNTg4LDIxNTk4LDU3NjgyLDMwMTI2LDI5OTI0LDQ1NzY5LDMzNjk0LDk2MzUsMTYsMjQsNDEzMCwzNjE2LDQwNDM0LDIzNDg5LDQyNzk4LDU1OTE3LDE4MDE4LDIzMDA1LDM1MTcxLDgyMTgsNjM0NTYsNDgwMjQsNDUyNTQsOTgzMCw2Njc3LDM4NjAsMTQ4MTcsMzM5NjYsNTQ5NDksMzc0NDEsNDY3OTEsNTg5NjQsNjI2NzEsNjI3MzQsNDcwMzUsNDQ4NzQ=
```
The message can then be decrypted as follows by the user Bob
```
tsc index.ts && node index.js decrypt [message]
```
For example
```
tsc index.ts && node index.js decrypt MjU2LDUwNDQwLDM4NCwyNCwxNjQxOCwxODE4MCw1NDQyMywyOTUxMyw0ODE2OCw1ODQzMiw0Mjg0MiwxNDA4LDI5NDc3LDY1NzUsMjU0NTIsOTc4MywxNjYyOSw1NzAxNyw1NjQ0LDEyNTg0LDU0ODUsNTAzNjQsMzIxMDUsMjU0NTEsNTYyMDYsMjc4ODksNDU4MjAsMzYyMyw0NjUwNywzMDU4OCwyMTU5OCw1NzY4MiwzMDEyNiwyOTkyNCw0NTc2OSwzMzY5NCw5NjM1LDU3ODk4LDEsMjU2MSwyMjg0OCw0OTE4MywzNDIzNyw1NDEzOSwyNzI4Niw0NzY3NCwxMjUxMSwyODYxMCw0MzE4LDI0OTkxLDY0MzYyLDE3MzkxLDE4NDg2LDE3MzcwLDEzNjk2LDM2MTI3LDU1NzgxLDM5MzU4LDQ3MjY3LDQ1NTA2LDEyOTA4LDM5MTQzLDUwMTIxLDExNjAsODIyNCw0MDU1Nyw0NjM0Nyw1NDU0OCw0NDksNjQ5ODEsMzM3ODQsNDU0MjUsNDc4NCw1MzMxMiw2MjI1NCwzNzE2Miw1NDg0Nyw3NjY0LDI2MTU5LDI3MTIzLDE1NzUwLDU4MDUzLDM3MTU2LDQzMzYwLDMwNDIzLDQ3ODk0LDQ3NTk2LDI2MDYzLDI0MjM2LDExNTMxLDIwOTg3LDM3OTEsNTcxMDEsMjU2ODEsNjQwODUsNjI1MTcsNDU3NDIsMzQ1NzUsNDE5MTEsMzI2MiwzMjU3NCwyMzcyMywxODc4Niw0OTk1MCw4MDQxLDY3NzgsMTg1Niw4Njc2LDUxMTMzLDU3NDMwLDE1Nzk2LDYxMTQ5LDU2ODU2LDcwODcsMzUwNzksNDYzODEsNDAzNTgsNjkwOCwxNjE0MCw3ODgyLDM0MDcxLDY0MjEwLDQ3OTAzLDUyNjIxLDEyMDg4LDU4NTMzLDI1MDAsMzYxMDQsMzE4MDgsNTg4NjQsMzcyNyw1OTA2MCwxMTM4Miw4ODcwLDEwMDAyLDU5NTIxLDMzMzY4LDI1MTc1LDg5MDAsMTI4MjQsMTI4NDgsMTE1NjgsMTI4NDksMTIzMzMsMjE1NTksMTQzODQsMTIzNDYsMTQ5MDEsMTM4NzcsMTI4NDYsMTMzNjQsMTI4OTAsNDUwLDI1NiwxNjM5NCw4MDI1LDQ4NTc2LDMxNjIxLDM4NjExLDE0OTU0LDU3Mjc0LDQ5NzEyLDU2OTQzLDQwNzIwLDI3MjMzLDYxNDM1LDEzODkxLDU1ODgwLDMyODM1LDc5ODksNTg3NjUsNDg4NTcsNDE4ODEsNDk4NDgsMjc4MjUsNTkxODYsNTE2MDgsMzUwMTEsODE5NiwyNzkzNiwyOTc0LDUzMDEsNDk2MjEsNTQ1MjksNjM3NDEsMjkwNTksNDUyMzMsMjMwNTgsMjU2LDE2Mzk0LDE4MTgwLDU0NDIzLDI5NTEzLDQ4MTY4LDU4NDMyLDQyODQyLDE0MDgsMjk0NzcsNjU3NSwyNTQ1Miw5NzgzLDE2NjI5LDU3MDE3LDU2NDQsMTI1ODQsNTQ4NSw1MDM2NCwzMjEwNSwyNTQ1MSw1NjIwNiwyNzg4OSw0NTgyMCwzNjIzLDQ2NTA3LDMwNTg4LDIxNTk4LDU3NjgyLDMwMTI2LDI5OTI0LDQ1NzY5LDMzNjk0LDk2MzUsMTYsMjQsNDEzMCwzNjE2LDQwNDM0LDIzNDg5LDQyNzk4LDU1OTE3LDE4MDE4LDIzMDA1LDM1MTcxLDgyMTgsNjM0NTYsNDgwMjQsNDUyNTQsOTgzMCw2Njc3LDM4NjAsMTQ4MTcsMzM5NjYsNTQ5NDksMzc0NDEsNDY3OTEsNTg5NjQsNjI2NzEsNjI3MzQsNDcwMzUsNDQ4NzQ=
```
Would return the decrypted message
```
Hello there
```
## Run the whole demo at once
To run all demo at once, use
```
tsc index.ts && node index.js all
```
If you face issues running, upgrade your global installation of typescript, or run
```
./node_modules/.bin/tsc index.ts && node index.js all
```

# Known issues
Hard to store identity object on file or as string. Which is why individual steps highlighted above won't work yet. Parsed string/object from file is then treated as plain `Object` rather than `IJsonIdentity` object. This needs some more research.
